import{t as L,r as d,p as V,v as U,x as R,G as j,j as e,d as T,s as M,B as x,A as E,z as r,D as m,T as f,Z as H,y as Y,_ as $,E as o,$ as z}from"./index-Ci_Ryvtz.js";import{b as K,l as O,s as _}from"./localStorage-B8oYglUC.js";import{u as G}from"./storage-CRbYAsCT.js";const Z=Y({title:o().min(1,"Tour title is required."),duration:o().min(1,"Duration is required."),price:o().min(1,"Price is required."),season:o().optional(),tourType:o().optional(),description:o().optional(),highlights:o().optional(),itinerary:o().optional(),image:o().url().optional().or(z("")),contactName:o().min(1,"Contact name is required."),contactEmail:o().email("Valid email required.")}),J={title:"",duration:"",price:"",season:"",tourType:"",description:"",highlights:"",itinerary:"",image:"",contactName:"",contactEmail:""};function te(){const{user:l,profile:t}=L(),[s,y]=d.useState(1),[b,h]=d.useState(null),[N,v]=d.useState(!1),[F,k]=d.useState(!1),[S,C]=d.useState(null),w=V(),u=4,{register:n,handleSubmit:q,setValue:g,trigger:A,watch:B,formState:{errors:a}}=U({resolver:R(Z),defaultValues:J}),p=B();d.useEffect(()=>{j&&(!p.contactName&&(t!=null&&t.name)&&g("contactName",t.name,{shouldDirty:!1}),!p.contactEmail&&(t!=null&&t.email||l!=null&&l.email)&&g("contactEmail",(t==null?void 0:t.email)||(l==null?void 0:l.email)||"",{shouldDirty:!1}))},[p.contactEmail,p.contactName,t==null?void 0:t.email,t==null?void 0:t.name,g,l==null?void 0:l.email]);const D=async()=>{h(null);const i=s===1?["title","duration","price"]:[];if(i.length&&!await A(i)){h("Please complete the required fields before continuing.");return}s<u&&y(s+1)},I=()=>{h(null),s>1&&y(s-1)},P=async i=>{h(null),v(!0);try{let c=i.image||"";if(S){if(!j)throw new Error("Storage is not configured.");c=await G(S,"seller-submissions")}if(j){if(!l)throw new Error("Please sign in to submit a tour.");await $({...i,image:c,highlights:(i.highlights||"").split(`
`).filter(Boolean),itinerary:(i.itinerary||"").split(`
`).filter(Boolean),ownerId:l.uid})}K({...i,image:c,highlights:(i.highlights||"").split(`
`).filter(Boolean),itinerary:(i.itinerary||"").split(`
`).filter(Boolean)}),!O()&&i.contactEmail&&i.contactName&&_({name:i.contactName,email:i.contactEmail,role:"seller"}),k(!0)}catch(c){h(c instanceof Error?c.message:"Unable to submit your tour.")}finally{v(!1)}};return F?e.jsxs(e.Fragment,{children:[e.jsx(T,{title:"Submit Tour",description:"Submit a tour proposal to the Kyrgyz Riders marketplace."}),e.jsx("div",{className:"min-h-[70vh] flex items-center justify-center px-4 bg-muted",children:e.jsxs("div",{className:"bg-card rounded-lg shadow-md p-6 sm:p-8 max-w-lg text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-secondary/20 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(M,{className:"h-8 w-8 text-secondary"})}),e.jsx("h1",{className:"text-2xl sm:text-3xl text-foreground mb-4",children:"Tour Submitted"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Thanks for sharing your experience. Your tour is pending admin approval."}),e.jsx(x,{onClick:()=>w("/tours"),className:"btn-micro bg-primary hover:bg-primary/90 text-primary-foreground",children:"Back to Tours"})]})})]}):e.jsxs("section",{className:"py-16 px-4 sm:px-6 lg:px-8 bg-muted",children:[e.jsx(T,{title:"Submit Tour",description:"Create a tour listing and submit it for admin approval."}),e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[e.jsxs("div",{children:[e.jsxs(x,{onClick:()=>w(-1),variant:"outline",className:"mb-4",children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsx("h1",{className:"text-3xl sm:text-4xl text-foreground mb-3",children:"Submit a Tour"}),e.jsx("p",{className:"text-muted-foreground",children:"Share your tour idea with our team. Approved submissions go live after review."})]}),e.jsxs("form",{onSubmit:q(P),className:"bg-card rounded-lg shadow-md p-4 sm:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Step ",s," of ",u]}),e.jsx("div",{className:"flex-1 h-1 bg-muted",children:e.jsx("div",{className:"h-1 bg-primary",style:{width:`${s/u*100}%`}})})]}),s===1&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"title",children:"Tour Title"}),e.jsx(m,{id:"title",...n("title"),placeholder:"e.g., Alpine Horse Trek",required:!0}),a.title&&e.jsx("p",{className:"text-xs text-red-600",children:a.title.message})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"duration",children:"Duration"}),e.jsx(m,{id:"duration",...n("duration"),placeholder:"e.g., 5 days",required:!0}),a.duration&&e.jsx("p",{className:"text-xs text-red-600",children:a.duration.message})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"price",children:"Price per Person"}),e.jsx(m,{id:"price",...n("price"),placeholder:"$950",required:!0}),a.price&&e.jsx("p",{className:"text-xs text-red-600",children:a.price.message})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"season",children:"Best Season"}),e.jsx(m,{id:"season",...n("season"),placeholder:"Spring - Autumn"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(r,{htmlFor:"tourType",children:"Tour Type"}),e.jsx(m,{id:"tourType",...n("tourType"),placeholder:"Trekking, cultural, horse riding..."})]})]}),s===2&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"description",children:"Short Description"}),e.jsx(f,{id:"description",...n("description"),rows:4,placeholder:"Describe the experience and key highlights."})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"highlights",children:"Highlights (one per line)"}),e.jsx(f,{id:"highlights",...n("highlights"),rows:4,placeholder:"Camp at Song Kol\\nMeet nomadic families\\nHorseback riding"})]})]}),s===3&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(r,{htmlFor:"itinerary",children:"Itinerary (one line per day)"}),e.jsx(f,{id:"itinerary",...n("itinerary"),rows:6,placeholder:"Day 1: Arrival and city tour\\nDay 2: Mountain hike\\nDay 3: Yurt stay"})]}),s===4&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"image",children:"Cover Image URL"}),e.jsx(m,{id:"image",...n("image"),placeholder:"https://..."}),a.image&&e.jsx("p",{className:"text-xs text-red-600",children:a.image.message})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"imageFile",children:"Or Upload an Image"}),e.jsx(m,{id:"imageFile",type:"file",accept:"image/*",onChange:i=>{var c;return C(((c=i.target.files)==null?void 0:c[0])||null)}}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Uploaded files will replace the URL above when submitted."})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"contactName",children:"Contact Name"}),e.jsx(m,{id:"contactName",...n("contactName"),placeholder:"Your full name",required:!0}),a.contactName&&e.jsx("p",{className:"text-xs text-red-600",children:a.contactName.message})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"contactEmail",children:"Contact Email"}),e.jsx(m,{id:"contactEmail",type:"email",...n("contactEmail"),placeholder:"you@example.com",required:!0}),a.contactEmail&&e.jsx("p",{className:"text-xs text-red-600",children:a.contactEmail.message})]})]}),b&&e.jsx("p",{className:"text-sm text-red-600",children:b}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[s>1&&e.jsxs(x,{variant:"outline",onClick:I,className:"flex-1",children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Back"]}),s<u?e.jsxs(x,{onClick:D,className:"flex-1 btn-micro bg-primary hover:bg-primary/90 text-primary-foreground",children:["Next",e.jsx(H,{className:"h-4 w-4 ml-2"})]}):e.jsx(x,{type:"submit",disabled:N,className:"flex-1 btn-micro bg-primary hover:bg-primary/90 text-primary-foreground",children:N?"Submitting...":"Submit Tour"})]})]})]})]})}export{te as CreateTourPage};
